import multiprocessing
import random
import time

from matplotlib import pyplot as plt


DATA_SIZE = 1000000
lst = []
logger = {}


def fill_data(n):
    while n > 0:
        n -= 1
        lst.append(random.randint(1, 100))


class timer:
    def __init__(self, message, workers, data_size):
        self.message = message
        self.workers = workers
        self.data_size = data_size

    def __enter__(self):
        self.start = time.time()
        return None

    def __exit__(self, type, value, traceback):
        elapsed_time = round((time.time() - self.start), 4)
        logger[self.workers] = elapsed_time
        print(self.message.format(elapsed_time))


for i in range(1, 128):
    workers = i
    with timer('Elapsed: {}s', workers, DATA_SIZE):
        with multiprocessing.Pool(workers) as pool:
            input_data = [DATA_SIZE // workers for _ in range(workers)]
            pool.map(fill_data, input_data)


print(logger)
data = logger
lists = sorted(data.items())

x, y = zip(*lists)
plt.plot(x, y)
plt.show()

"""
data = {
1: 0.5128, 2: 0.2547, 3: 0.173, 4: 0.1335, 5: 0.1089, 6: 0.0938, 7: 0.1465, 8: 0.124, 9: 0.126, 10: 0.1146, 11: 0.1077, 12: 0.1032, 13: 0.117, 14: 0.1268, 15: 0.1255, 16: 0.1161, 17: 0.123, 18: 0.1143, 19: 0.119, 20: 0.1168, 21: 0.1163, 22: 0.1242, 23: 0.1173, 24: 0.1162, 25: 0.1185, 26: 0.1227, 27: 0.1214, 28: 0.1265, 29: 0.126, 30: 0.1231, 31: 0.1228, 32: 0.1223, 33: 0.1266, 34: 0.1237, 35: 0.1257, 36: 0.1329, 37: 0.1402, 38: 0.1411, 39: 0.1254, 40: 0.1307, 41: 0.132, 42: 0.1297, 43: 0.1336, 44: 0.1362, 45: 0.1342, 46: 0.1392, 47: 0.136, 48: 0.1349, 49: 0.1387, 50: 0.1378, 51: 0.1369, 52: 0.1466, 53: 0.1498, 54: 0.1437, 55: 0.14, 56: 0.1434, 57: 0.1444, 58: 0.1442, 59: 0.1455, 60: 0.1456, 61: 0.1486, 62: 0.1495, 63: 0.1534, 64: 0.1496, 65: 0.1544, 66: 0.1568, 67: 0.1601, 68: 0.1554, 69: 0.1505, 70: 0.1594, 71: 0.1674, 72: 0.1615, 73: 0.1569, 74: 0.1569, 75: 0.1703, 76: 0.1768, 77: 0.1631, 78: 0.166, 79: 0.1623, 80: 0.1622, 81: 0.1699, 82: 0.1676, 83: 0.1687, 84: 0.17, 85: 0.1676, 86: 0.1709, 87: 0.1742, 88: 0.1739, 89: 0.1722, 90: 0.1749, 91: 0.1729, 92: 0.174, 93: 0.1759, 94: 0.1745, 95: 0.1778, 96: 0.1821, 97: 0.1827, 98: 0.1757, 99: 0.1851, 100: 0.183, 101: 0.184, 102: 0.187, 103: 0.1855, 104: 0.184, 105: 0.1959, 106: 0.1877, 107: 0.1883, 108: 0.1891, 109: 0.1944, 110: 0.1908, 111: 0.1915, 112: 0.1968, 113: 0.1925, 114: 0.195, 115: 0.1966, 116: 0.1994, 117: 0.198, 118: 0.1994, 119: 0.2008, 120: 0.1992, 121: 0.2012, 122: 0.205, 123: 0.2056, 124: 0.2038, 125: 0.2097, 126: 0.2101, 127: 0.2085
}
"""